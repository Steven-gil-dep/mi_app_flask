<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Formatos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .resultado { margin-top: 20px; white-space: pre-line; background: #f4f4f4; padding: 10px; border-radius: 5px; }
        .preview { background: #eef; padding: 10px; margin-top: 10px; border: 1px solid #99c; border-radius: 5px; }
    </style>
</head>
<body>
    <h2>Generador de Formatos</h2>
    <form method="POST">
        <label>Usuario:</label><br>
        <input type="text" name="usuario" required><br><br>

        <label>Placa:</label><br>
        <input type="text" name="placa" required><br><br>

        <label>Medio:</label><br>
        <select name="medio" required>
            <option value="1">Presencial</option>
            <option value="2">Virtual</option>
        </select><br><br>

        <label>Tipo:</label><br>
        <select name="tipo" id="tipo" required>
            <option value="req">Requerimiento</option>
            <option value="inc">Incidente</option>
        </select><br><br>

        <label>Opci贸n:</label><br>
        <select name="opcion" id="opcion" required></select><br><br>

        <label>Soluci贸n sugerida:</label>
        <div class="preview" id="solucionPreview">Selecciona una opci贸n...</div>

        <label>Detalles adicionales:</label><br>
        <textarea name="detalles" rows="4" cols="50"></textarea><br><br>

        <button type="submit">Generar</button>
    </form>

    {% if resultado %}
    <div class="resultado">
        <h3>Formato generado:</h3>
        <pre>{{ resultado }}</pre>
    </div>
    {% endif %}

    <script>
        const requerimientos = {{ requerimientos|tojson }};
        const incidentes = {{ incidentes|tojson }};

        const tipoSelect = document.getElementById('tipo');
        const opcionSelect = document.getElementById('opcion');
        const solucionPreview = document.getElementById('solucionPreview');

        function actualizarOpciones() {
            const tipo = tipoSelect.value;
            const opciones = tipo === 'req' ? requerimientos : incidentes;

            opcionSelect.innerHTML = '';
            for (const [key, value] of Object.entries(opciones)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value[0];
                opcionSelect.appendChild(option);
            }
            actualizarPreview();
        }

        function actualizarPreview() {
            const tipo = tipoSelect.value;
            const opciones = tipo === 'req' ? requerimientos : incidentes;
            const seleccion = opcionSelect.value;
            solucionPreview.textContent = seleccion && opciones[seleccion]
                ? opciones[seleccion][1]
                : "Selecciona una opci贸n...";
        }

        tipoSelect.addEventListener('change', actualizarOpciones);
        opcionSelect.addEventListener('change', actualizarPreview);

        window.onload = actualizarOpciones;
    </script>
</body>
</html>
